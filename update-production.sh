#!/bin/bash

# üöÄ –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å–µ—Ä–≤–µ—Ä–∞
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./update-production.sh

echo "üöÄ –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å–µ—Ä–≤–µ—Ä..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
if ! ssh -i ~/.ssh/aero_lunch_key ubuntu@158.160.177.251 "echo 'SSH OK'"; then
    echo "‚ùå –û—à–∏–±–∫–∞ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è"
    exit 1
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
echo "üîÑ –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ..."
ssh -i ~/.ssh/aero_lunch_key ubuntu@158.160.177.251 "/home/ubuntu/aero-lunch-app/auto-update.sh"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
echo "üß™ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Ä–≤–µ—Ä..."
sleep 5
if curl -s "https://aero-lunch.ru/api/admin/stats" -H "x-admin-password: admin123" | grep -q "todayOrders"; then
    echo "‚úÖ –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç!"
    echo "üåê –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: https://aero-lunch.ru"
else
    echo "‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å"
fi

echo "üéâ –ì–æ—Ç–æ–≤–æ!" 