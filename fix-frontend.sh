#!/bin/bash

echo "๐จ ะะกะะะะะะฏะะ ะคะะะะขะะะ ะะ ะะะะะะะจะะะ"

# ะัะพะฒะตััะตะผ ัะพะตะดะธะฝะตะฝะธะต
echo "๐ก ะัะพะฒะตััะตะผ ัะพะตะดะธะฝะตะฝะธะต..."
if ! ping -c 1 aero-lunch.ru &> /dev/null; then
    echo "โ ะกะตัะฒะตั ะฝะตะดะพัััะฟะตะฝ"
    exit 1
fi

echo "โ ะกะตัะฒะตั ะดะพัััะฟะตะฝ"

# ะัะฟะพะปะฝัะตะผ ะบะพะผะฐะฝะดั ะฝะฐ ัะตัะฒะตัะต
echo "๐ง ะัะฟัะฐะฒะปัะตะผ ััะพะฝัะตะฝะด..."

ssh root@aero-lunch.ru 'cd /root/aero-lunch-app && echo "๐ฅ ะะฑะฝะพะฒะปัะตะผ ะบะพะด..." && git pull origin main && echo "๐ฆ ะฃััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะทะฐะฒะธัะธะผะพััะธ..." && npm ci && echo "๐จ ะะะะะกะะะะะะะ ะคะะะะขะะะ..." && npm run build && echo "๐ ะะพะฟะธััะตะผ ะฒ nginx..." && cp -r dist/* /usr/share/nginx/html/ && echo "๐ ะะตัะตะทะฐะณััะถะฐะตะผ nginx..." && systemctl reload nginx && echo "โ ะัะพะฒะตััะตะผ ัะตะทัะปััะฐั..." && ls -la /usr/share/nginx/html/index.html && echo "๐ ะะะขะะะ!"'

echo "โ ะคัะพะฝัะตะฝะด ะธัะฟัะฐะฒะปะตะฝ! ะัะพะฒะตัััะต https://aero-lunch.ru" 